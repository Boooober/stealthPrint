<html>
<head>
	<meta charset="utf-8">
	
	<style>
		body {position:relative}
		#form {position:absolute; top:10px; left:10px}
		#media {margin: 0 auto;border: 1px solid green;padding-top:5px;}
		#media:after{content:"";display:block;clear:both}
		#media_size {width:100%;text-align:center;border:1px dashed green; margin-bottom:5px;box-sizing:border-box;}
		.element {background-color:green;box-sizing:border-box;border:1px solid red;float:left}
		
		
	</style>
</head>
<body>

	<form id="form">
		width<input type="text" id="width" value="41"><br /><br />
		height<input type="text" id="height" value="63"><br /><br />
		count<input type="text" id="count" value="5"><br /><br />
	</form>
	
	<!--
	<div id="media">
		<div id="media_size"></div>
	</div>
	-->
	
<script>
	
	var media = document.getElementById('media');
	var mediaSize = document.getElementById('media_size');
	var form = document.getElementById('form');
	
	var printWidth = 41,
		printHeight = 63,
		printCount = 5,
		mediaWidthArr = [127,160];
		
	
		
	form.addEventListener('change', function(e){
		var elem = e.target;
		
		switch (elem.id){
			case 'width':
				printWidth = parseInt(document.getElementById('width').value);
				break;
			case 'height':
				printHeight = parseInt(document.getElementById('height').value);
				break;
			case 'count':
				printCount = parseInt(document.getElementById('count').value);
				break;
		}
		
		
		calc();
	});
	
	function calc (){
		
		var optimalLength = PrintLengthObj; //REFACTOR!
		var optimalMedia = new OptimalMediaObj();
		
		// ѕри каждом пересчете обнул€ем результаты предыдущих вычислений перед циклом
		
		for ( var i = 0, medias = mediaWidthArr.length; i < medias; i++ ){
			var wObj = new SetObjParams(printWidth, printHeight, mediaWidthArr[i], printCount); //horizontalSide, verticalSide, mediaWidth and printCount
			var hObj = new SetObjParams(printHeight, printWidth, mediaWidthArr[i], printCount);
			
			lineUp(wObj, hObj, optimalLength, optimalMedia, mediaWidthArr[i]);

		};	
		
				console.log(optimalMedia);
		
		
	};
	
	var SetObjParams = function (horizontalSide, verticalSide, mediaWidth, printCount){		
		
		this.coef = mediaWidth / horizontalSide;
		this.mediaCapacity = Math.floor(this.coef);
		if (this.mediaCapacity != 0) {
			this.copiesRest = printCount % this.mediaCapacity;
		};
		this.printCount = printCount;
		this.horizontalSide = horizontalSide;
		this.verticalSide = verticalSide;
	};

	
	
	
	var lineUp = function (wObj, hObj, optimalLength, optimalMedia, mediaWidth){
	
	//	console.log('-------This is ' + mediaWidth + ' media-------');
	
		
		//Calculation of printLength
		var optimalPrintLength = optimalLength.calcOptPrintLength (wObj, hObj);
	
		//Calculation of printSquare
		var mediaSquare = optimalPrintLength * mediaWidth;
		var printSquare = wObj.horizontalSide * wObj.verticalSide * wObj.printCount;
		var restSquare = mediaSquare - printSquare;
		
		if (optimalMedia.checkMinSquare(restSquare) === true){
			optimalMedia.setRestSquare(restSquare);
			optimalMedia.setPrintSquare(printSquare);
			optimalMedia.setMediaWidth(mediaWidth);
			optimalMedia.setPrintLength(optimalPrintLength);
		};
	};
	
	
	
	
	var PrintLengthObj = {
		
		// This method calculates count of copies lines in media.
		calcCountOfLines : function (copies, mediaCapacity){
			return Math.ceil( copies / mediaCapacity );
		},

		// This method calculates straight length of print in cm.
		calcStrPrintLength : function (w){
			var linesCount = this.calcCountOfLines(w.printCount, w.mediaCapacity);
			var printLength = linesCount * w.verticalSide;
			return printLength;
		},
		
		// This method calculates length of line up that contains straight and rotated (rest) copies in cm.
		calcRotPrintLength : function (w, h){
		
			// ƒелим на две части - влазит полность по mediaCapacity и остаток, который не влазит
			var strCount = w.printCount - w.copiesRest;
			var rotCount = w.copiesRest;
		
			// –асчитываем количество полных линий на материале, которые заполн€ют пр€мые и повернутые копии 
			var strLinesCount = this.calcCountOfLines(strCount, w.mediaCapacity);
			var rotLinesCount = this.calcCountOfLines(rotCount, h.mediaCapacity);
			
			// –асчитываем погонную длинну материала дл€ пр€мых и повернутых копий
			var strLength = strLinesCount * w.verticalSide;
			var rotLength = rotLinesCount * h.verticalSide;
			
			// –асчитываем общую длинну печати пр€мых и повернутых копий
			var sumPrintLength = strLength + rotLength;

			return sumPrintLength;			
		},
		
		calcOptPrintLength: function(w, h) {
			var rotPrintLengthW = 0, rotPrintLengthH = 0, strPrintLengthW = 0, strPrintLengthH = 0;
			
			if (w.mediaCapacity != 0){
				rotPrintLengthW = this.calcRotPrintLength(w, h);
				strPrintLengthW = this.calcStrPrintLength(w);
			}; 
			
			if (h.mediaCapacity != 0){
				rotPrintLengthH = this.calcRotPrintLength(h, w);
				strPrintLengthH = this.calcStrPrintLength(h);
			};
			
			// Rotate rest copies to calculate summary print length. Select optimal length by comparing each other.
			var optimalRotPrintLength = this.returnMinValue(rotPrintLengthW, rotPrintLengthH);
			// Straight orientation of rest copies. Calculate optimal straight length and compare each other.
			var optimalStrPrintLength = this.returnMinValue(strPrintLengthW, strPrintLengthH);
			var optimalPrintLength = this.returnMinValue(optimalRotPrintLength, optimalStrPrintLength);
			
			return optimalPrintLength;
		},
		
		returnMinValue : function (v1, v2){
			if (v1 != 0 && v2 != 0){
				if (v1 <= v2) {
					return v1;
				} else {
					return v2;
				};
			};
			if (v1 === 0 && v2 != 0) return v2;
			if (v2 === 0 && v1 != 0) return v1;			
			if (v2 === 0 && v1 === 0) return 0;			
		}
		
	
	};
	
	var OptimalMediaObj = function(){
		this.restSquare = 0;
		
		this.checkMinSquare = function (currentValue){
			if ( this.restSquare == 0 || currentValue < this.restSquare ){
				return true;
			};
			return false;
		};
		
		this.setRestSquare = function (currentValue){
			this.restSquare = currentValue;
		};
		
		this.setPrintSquare = function (currentValue){
			this.printSquare = currentValue;
		};
		
		this.setMediaWidth = function (currentValue){
			this.mediaWidth = currentValue;
		};
		
		this.setPrintLength = function (currentValue){
			this.printLength = currentValue;
		};
	};

	


</script>

</body>
</html>
