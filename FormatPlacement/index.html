<html>
<head>
	<meta charset="utf-8">
	
	<style>
		body {position:relative}
		#form {position:absolute; top:10px; left:10px}
		#media {margin: 0 auto;border: 1px solid green;padding-top:5px;}
		#media:after{content:"";display:block;clear:both}
		#media_size {width:100%;text-align:center;border:1px dashed green; margin-bottom:5px;box-sizing:border-box;}
		.element {background-color:green;box-sizing:border-box;border:1px solid red;float:left}
		
		
	</style>
</head>
<body>

	<form id="form">
		width<input type="text" id="width" value="41"><br /><br />
		height<input type="text" id="height" value="63"><br /><br />
		count<input type="text" id="count" value="5"><br /><br />
	</form>
	
	<!--
	<div id="media">
		<div id="media_size"></div>
	</div>
	-->
	
<script>
	
	var media = document.getElementById('media');
	var mediaSize = document.getElementById('media_size');
	var form = document.getElementById('form');
	
	var printWidth = 41,
		printHeight = 63,
		printCount = 5,
		mediaWidthArr = [127,160];
		
	
		
	form.addEventListener('change', function(e){
		var elem = e.target;
		
		switch (elem.id){
			case 'width':
				printWidth = parseInt(document.getElementById('width').value);
				break;
			case 'height':
				printHeight = parseInt(document.getElementById('height').value);
				break;
			case 'count':
				printCount = parseInt(document.getElementById('count').value);
				break;
		}
		
		
		calc();
	});
	
	
	var SetObjParams = function (horizontalSide, verticalSide, mediaWidth, printCount){		
		
		this.coef = mediaWidth / horizontalSide;
		this.mediaCapacity = Math.floor(this.coef);
		if (this.mediaCapacity != 0) {
			this.mediaRest = mediaWidth - this.mediaCapacity * horizontalSide;
			this.copiesRest = printCount % this.mediaCapacity;
		};
		this.printCount = printCount;
		this.horizontalSide = horizontalSide;
		this.verticalSide = verticalSide;
	};

	
	
	
	var lineUp = function (widthObj, heightObj, optimalLength){
		
			var printLength = optimalLength.calcPrintLength(widthObj, heightObj);
			optimalLength.setPrintLength(printLength);

	};
	
	
	
	
	
	
	
	
	

	var optimalPrintLength = function (){
	
		this.value = 0;
		
		this.calcLineUpLength = function (lengthSide, printCount, mediaCapacity){
			mediaCapacity = mediaCapacity || 1;
			console.log(mediaCapacity, 'MediaCapacity in this case')
			return lengthSide * printCount / mediaCapacity;
		};
		
		
		
		
		
		
		
		
		
		// REFACTOR!!!
		
		this.calcPrintLength = function (widthObj, heightObj){

		// количество копий, которые полностью заполн€ют ширину материала
			var widthCopiesMainCount = widthObj.printCount - widthObj.copiesRest;
			var heightCopiesMainCount = widthObj.printCount - heightObj.copiesRest;
			
			
			
			/*	
			//≈сли файл не влазит в рулон, то copiesRest не существует. Ќужна проверка. ћетод не работает.
			//–азбить на метод, который присвоит переменным разные CopiesSumPrintLength
			if (mediaCapacity != 0){
			
			}else{
				return 'impossible to line up fils on current media';
			};
			*/
			
			
			console.log(widthCopiesMainCount, 'widthCopiesMainCount');
			console.log(heightCopiesMainCount, 'heightCopiesMainCount');
			
		// погонные метры копий, которые полностью заполнили рулон
			var widthCopiesMainPrintLength = this.calcLineUpLength( widthObj.verticalSide, widthCopiesMainCount, widthObj.mediaCapacity );
			var heightCopiesMainPrintLength = this.calcLineUpLength( heightObj.verticalSide, heightCopiesMainCount, heightObj.mediaCapacity );

			console.log(widthCopiesMainPrintLength, 'widthCopiesMainPrintLength');
			console.log(heightCopiesMainPrintLength, 'heightCopiesMainPrintLength');
				
		// ѕровер€ем есть ли копии, которые не заполнили рулон и есть возможность развернуть файлы другой стороной. —читаем их погонные метры
			if ( heightObj.mediaCapacity != 0 && widthObj.copiesRest % heightObj.mediaCapacity <= widthObj.copiesRest ){
				var widthRestLinesCount = this.calcCountOfRestLines(widthObj.copiesRest, heightObj.mediaCapacity );
				var widthCopiesRestPrintLength = this.calcLineUpLength(widthObj.horizontalSide, widthRestLinesCount);
			} else {
				
			};
			
			if ( widthObj.mediaCapacity != 0 && heightObj.copiesRest % widthObj.mediaCapacity <= heightObj.copiesRest ){
				var heightRestLinesCount = this.calcCountOfRestLines(heightObj.copiesRest, widthObj.mediaCapacity );
				var heightCopiesRestPrintLength = this.calcLineUpLength(heightObj.horizontalSide, heightRestLinesCount);
			};
			
			var widthCopiesSumPrintLength = widthCopiesMainPrintLength + widthCopiesRestPrintLength;
			var heightCopiesSumPrintLength = heightCopiesMainPrintLength + heightCopiesRestPrintLength;
				console.log(widthCopiesSumPrintLength, 'widthCopiesSumPrintLength');
				console.log(heightCopiesSumPrintLength, 'heightCopiesSumPrintLength');

			if ( widthCopiesSumPrintLength <= heightCopiesSumPrintLength ) {
				return widthCopiesSumPrintLength;
			} else {
				return heightCopiesSumPrintLength;
			};
		};
		
		// REFACTOR!!!
		
		
		
		
		
		
		
		
		
		
		
		this.calcCountOfRestLines = function (restCopies, mediaCapacity){
			return Math.ceil( restCopies / mediaCapacity );
		};
		
		this.setPrintLength = function(printLength){
			if ( this.value == 0 || this.value > printLength) {
				this.value = printLength;
			};
		};
		
		
	
	}
	

	function calc (){
		
		var optimalLength = new optimalPrintLength();
		// ѕри каждом пересчете обнул€ем результаты предыдущих вычислений перед циклом
		
		for ( var i = 0, medias = mediaWidthArr.length; i < medias; i++ ){
			var widthObj = new SetObjParams(printWidth, printHeight, mediaWidthArr[i], printCount); //horizontalSide, verticalSide, mediaWidth and printCount
			var heightObj = new SetObjParams(printHeight, printWidth, mediaWidthArr[i], printCount);
			
			lineUp(widthObj, heightObj, optimalLength);
			
			console.log(widthObj);
			console.log(heightObj);
			console.log(optimalLength.value, 'optPrintLength');
			
			
		};	
		
		console.log('------------==================------------------');
		console.log('------------==================------------------');
		console.log('------------==================------------------');
	};

</script>

</body>
</html>
